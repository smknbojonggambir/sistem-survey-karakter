<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Survey Karakter 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5; /* Indigo Modern */
            --primary-dark: #4338ca;
            --secondary: #0ea5e9; /* Sky Blue */
            --bg: #f8fafc;
            --surface: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 100px; /* Space for bottom nav */
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 30px 20px 60px 20px;
            border-radius: 0 0 30px 30px;
            color: white;
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: -40px;
        }
        .header h1 { margin: 0; font-size: 22px; font-weight: 800; letter-spacing: -0.5px; }
        .header p { margin: 5px 0 0; font-size: 13px; opacity: 0.9; }

        /* CONTAINER */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }

        /* CARDS */
        .card {
            background: var(--surface);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.5);
        }

        h2 { 
            margin: 0 0 20px 0; 
            font-size: 16px; 
            color: var(--primary); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        h2::before { content: ''; display: block; width: 4px; height: 16px; background: var(--secondary); border-radius: 2px; }

        /* FORM ELEMENTS */
        .form-group { margin-bottom: 16px; }
        label { display: block; font-size: 12px; font-weight: 700; margin-bottom: 8px; color: var(--text-muted); text-transform: uppercase; }
        
        select {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 2px solid var(--border);
            font-size: 14px;
            font-weight: 600;
            color: var(--text-main);
            background-color: #f8fafc;
            transition: 0.3s;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2364748b%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 12px auto;
        }
        select:focus { border-color: var(--primary); outline: none; background-color: #fff; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }
        select:disabled { background-color: #e2e8f0; color: #94a3b8; cursor: not-allowed; }

        /* BUTTONS */
        .btn-primary {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            border: none;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:active { transform: scale(0.98); }
        
        .btn-refresh {
            background: #eff6ff;
            color: var(--primary);
            border: 1px solid transparent;
            margin-bottom: 15px;
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        /* SOAL ITEMS */
        .q-item {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px dashed var(--border);
        }
        .q-item:last-child { border-bottom: none; }
        
        .q-text {
            font-size: 15px;
            font-weight: 600;
            line-height: 1.6;
            margin-bottom: 16px;
            display: block;
        }

        .options-grid {
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }

        .opt-label {
            position: relative;
            cursor: pointer;
            flex: 1;
        }

        .opt-label input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .opt-circle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            aspect-ratio: 1;
            background: #f1f5f9;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-muted);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }

        .opt-label input:checked ~ .opt-circle {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
        }

        /* REPORT TABLES */
        table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 13px; }
        th { text-align: left; padding: 12px; color: var(--text-muted); border-bottom: 2px solid var(--border); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 14px 12px; border-bottom: 1px solid var(--border); }
        tr:last-child td { border-bottom: none; }
        .badge { 
            background: #e0e7ff; 
            color: var(--primary); 
            padding: 6px 10px; 
            border-radius: 20px; 
            font-weight: 700; 
            font-size: 12px;
            display: inline-block;
        }

        /* NAVIGATION */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            display: flex;
            padding: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 100;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .nav-item {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 20px;
            transition: 0.3s;
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
        }

        /* FOOTER CREDIT */
        .credit {
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 30px;
            padding-bottom: 20px;
        }
        .credit a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
        }

        /* UTILS */
        .hidden { display: none !important; }
        
        .loader {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(5px);
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Animation */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div id="loader" class="loader hidden">
        <div class="spinner"></div>
        <span id="load-text" style="font-weight: 600; color: var(--text-main);">Memuat...</span>
    </div>

    <div class="header">
        <h1>Survey Karakter</h1>
        <p>SMK Negeri Bojonggambir â€¢ Tahun 2026</p>
    </div>

    <div id="page-siswa" class="container fade-in">
        <div style="height: 30px;"></div> <div class="card">
            <h2>Identitas Siswa</h2>
            <div class="form-group">
                <label>PILIH KELAS</label>
                <select id="kelas" onchange="loadNama()">
                    <option value="">-- Ketuk untuk memilih --</option>
                    <option value="X APHP">X APHP</option>
                    <option value="X DKV 1">X DKV 1</option>
                    <option value="X DKV 2">X DKV 2</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>NAMA SISWA</label>
                <select id="nama" disabled>
                    <option value="">Pilih kelas terlebih dahulu...</option>
                </select>
            </div>
        </div>
        
        <div class="card">
            <h2>Daftar Pertanyaan</h2>
            <p style="font-size:13px; color:var(--text-muted); margin-bottom:20px;">Isi skala 1 (Kurang) sampai 5 (Sangat Baik)</p>
            <div id="survey-list"></div>
        </div>

        <button class="btn-primary" onclick="kirimSurvey()">KIRIM JAWABAN SAYA</button>
        
        <div class="credit">
            Pembuat: <a href="https://www.kangruli.web.id" target="_blank">Kang Ruli</a>
        </div>
    </div>

    <div id="page-wali" class="container hidden fade-in">
        <div style="height: 30px;"></div>
        
        <div class="card">
            <h2>Rekapitulasi Kelas</h2>
            <button class="btn-refresh" onclick="loadReport()">ðŸ”„ Refresh Data Terbaru</button>
            <div id="report-kelas" style="overflow-x: auto;">Belum ada data</div>
        </div>
        
        <div class="card">
            <h2>Riwayat Input Terakhir</h2>
            <div id="report-siswa" style="overflow-x: auto;">Belum ada data</div>
        </div>

        <div class="credit">
            Pembuat: <a href="https://www.kangruli.web.id" target="_blank">Kang Ruli</a>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="nav('siswa')">SISWA</div>
        <div class="nav-item" onclick="nav('wali')">GURU/WALI</div>
    </div>

<script>
    // --- KONFIGURASI ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyrQLwLxUTeoRK17qmgc2SGq6kXRu1DA-vuumFvp40wlzK60z31Ngjp3lgN60uBUd_22w/exec"; 

    // DATA SISWA (Cleaned & Sorted)
    const DATA_SISWA = {
        "X APHP": [
            "Fauzan Arifurrohman", "Gunawan", "Ilham Fauzi", "M.Iqbal Pratama Dn.", 
            "Muhamad Andika", "Muhamad Hasbi", "Mutia Lasmi Insani", "Ramdan Maulana", 
            "Reski Hidayat", "Resya Rahmawati", "Rifki Age", "Rizki Miuhamad Fauzi", 
            "Rizki Muhamad Fauzi", "Ruli Raisman", "Saepul Ulum", "Siti Fitriyani", "Siti Nur Afiani"
        ],
        "X DKV 1": [
            "Anwar Mutaqin", "Ayyisy Maulida Isnaeni", "Dede Nurul Alamsyah", "Fahmi Kurniansyah", 
            "Faiz Kurniawan", "Fitrah Rizki", "Ilfah Sadiatul Ummah", "Karin Nuraeni", 
            "Lutvi Abdul Jabar", "M.Parhan Maulana", "Mh Risk", "Pahri Kirman", 
            "Purnama Maulidan", "Rama Radila Putra", "Rangga Al", "Raynaldy Raftansyah", 
            "Rikza Dzilfikri", "Rikza Dzipfikri", "Risa Fadila", "Rizki Abdul Rozak", 
            "Siti Nafisa", "Wendi"
        ],
        "X DKV 2": [
            "Akbar Ferdiansyah", "Dede Dian Ajhari", "Erik Heryawan", "Fathan Putra Nadadan", 
            "Galih Desta M", "Huh", "Masyail Lu'luil Maknun", "Muhamad Azam Alghifari", 
            "Muhamad Regit Azharul A", "Paradina Aulia", "Rafka Fikri Azani", "Rangga Prayoga", 
            "Revan Rahmawan", "Ripan Lesmana", "Rizqon", "Sahrul Gunawan", 
            "Salpa Fajriatul M", "Saptiana", "Siti Paujiyah", "Syifa Azzahra", "Yulia Astiani"
        ]
    };

    const SOAL = [
        "Saya datang ke sekolah tepat waktu setiap hari.",
        "Saya masuk kelas sebelum bel berbunyi.",
        "Saya mematuhi tata tertib sekolah meskipun tidak diawasi.",
        "Saya mengenakan seragam sesuai aturan sekolah.",
        "Saya mengerjakan tugas sekolah tepat waktu.",
        "Saya tidak menyontek saat ulangan atau tugas.",
        "Saya bertanggung jawab atas kesalahan yang saya buat.",
        "Saya meminta maaf jika melakukan kesalahan.",
        "Saya menjaga kebersihan kelas tanpa disuruh.",
        "Saya membuang sampah pada tempatnya.",
        "Saya menghormati guru di dalam dan luar kelas.",
        "Saya berbicara sopan kepada guru dan teman.",
        "Saya tidak berkata kasar atau menghina orang lain.",
        "Saya membantu teman yang kesulitan belajar.",
        "Saya bersikap jujur dalam setiap keadaan.",
        "Saya tidak merusak fasilitas sekolah.",
        "Saya menjaga nama baik sekolah di manapun berada.",
        "Saya fokus memperhatikan saat guru menjelaskan pelajaran.",
        "Saya tidak bermain HP saat pelajaran berlangsung.",
        "Saya mengerjakan tugas sendiri sebelum meminta bantuan.",
        "Saya siap menerima konsekuensi jika melanggar aturan.",
        "Saya berusaha memperbaiki diri segera setelah ditegur.",
        "Saya menghargai perbedaan pendapat dengan teman.",
        "Saya tidak membully atau merendahkan teman.",
        "Saya mampu menahan emosi saat sedang marah.",
        "Saya tetap berkata jujur meskipun dalam situasi sulit.",
        "Saya ikut membantu menjaga ketertiban kelas.",
        "Saya berusaha menjadi contoh perilaku baik bagi teman.",
        "Saya bertanggung jawab menjaga amanah yang diberikan.",
        "Saya melaksanakan jadwal piket dengan sungguh-sungguh.",
        "Saya tidak pernah membolos sekolah.",
        "Saya mematuhi peraturan dan hikmat saat upacara bendera.",
        "Saya bersikap sopan dan bijak di media sosial.",
        "Saya tidak menyebarkan berita bohong (hoaks) atau kebencian.",
        "Saya bersyukur atas kesempatan dapat belajar di sekolah.",
        "Saya menghargai waktu dan tidak menunda pekerjaan.",
        "Saya berusaha disiplin meskipun tidak ada sanksi.",
        "Saya berdoa sebelum dan sesudah kegiatan belajar.",
        "Saya menghormati orang yang lebih tua di lingkungan sekolah.",
        "Saya membantu orang lain dengan ikhlas tanpa pamrih.",
        "Saya selalu menjaga ucapan dan sikap saya.",
        "Saya mengakui kelebihan dan kekurangan diri sendiri.",
        "Saya berusaha konsisten dalam berbuat kebaikan.",
        "Saya belajar dari kesalahan agar tidak terulang.",
        "Saya tidak mudah menyalahkan orang lain atas kegagalan.",
        "Saya siap dan bertekad menjadi pribadi yang lebih baik.",
        "Saya menjalankan tanggung jawab saya sebagai siswa.",
        "Saya berkomitmen mematuhi seluruh aturan sekolah.",
        "Saya merasa bangga ketika berperilaku jujur dan disiplin.",
        "Saya ingin terus memperbaiki akhlak dan sikap saya."
    ];

    // Init
    const el = (id) => document.getElementById(id);
    const list = el('survey-list');
    
    // Render Questions with Modern Grid
    SOAL.forEach((q, i) => {
        list.innerHTML += `
        <div class="q-item" id="soal-${i}">
            <span class="q-text">${i+1}. ${q}</span>
            <div class="options-grid">
                ${[1,2,3,4,5].map(n => `
                    <label class="opt-label">
                        <input type="radio" name="q${i}" value="${n}">
                        <div class="opt-circle">${n}</div>
                    </label>
                `).join('')}
            </div>
        </div>`;
    });

    function loadNama() {
        const k = el('kelas').value;
        const n = el('nama');
        n.innerHTML = '<option value="">-- Pilih Nama Siswa --</option>';
        if (k && DATA_SISWA[k]) {
            n.disabled = false;
            DATA_SISWA[k].sort().forEach(nama => n.innerHTML += `<option value="${nama}">${nama}</option>`);
        } else {
            n.disabled = true;
            n.innerHTML = '<option value="">Pilih Kelas Dulu</option>';
        }
    }

    // --- FUNGSI NAVIGASI DENGAN PASSWORD ---
    // Menggunakan sessionStorage agar user hanya perlu input password sekali selama browser tidak ditutup
    function nav(tab) {
        
        // Cek Keamanan jika masuk menu Wali
        if (tab === 'wali') {
            const sudahLogin = sessionStorage.getItem('auth_wali_2026');
            
            if (!sudahLogin) {
                const password = prompt("Masukkan PIN Keamanan untuk Guru/Wali:");
                
                if (password === null) {
                    return; // Jika tekan Cancel, diam di tempat
                }
                
                if (password !== '12345') {
                    alert("Akses Ditolak: PIN Salah!");
                    return; // Stop, jangan pindah tab
                } else {
                    // Simpan status login sementara
                    sessionStorage.setItem('auth_wali_2026', 'true');
                    alert("Akses Diberikan. Selamat datang.");
                }
            }
        }

        // Logika Pindah Halaman (Animation Reset)
        const s = el('page-siswa');
        const w = el('page-wali');
        
        s.style.animation = 'none';
        w.style.animation = 'none';
        
        setTimeout(() => {
            s.style.animation = '';
            w.style.animation = '';
            
            s.classList.toggle('hidden', tab !== 'siswa');
            w.classList.toggle('hidden', tab !== 'wali');
            
            document.querySelectorAll('.nav-item').forEach((btn, i) => {
                btn.classList.toggle('active', (tab === 'siswa' && i === 0) || (tab === 'wali' && i === 1));
            });
            
            if (tab === 'wali') loadReport();
            window.scrollTo(0,0);
        }, 10);
    }

    function toggleLoader(show, text="Mohon Tunggu...") {
        el('load-text').innerText = text;
        el('loader').classList.toggle('hidden', !show);
    }

    function kirimSurvey() {
        const data = {
            nama: el('nama').value,
            kelas: el('kelas').value,
            jawaban: []
        };

        if (!data.nama || !data.kelas) return alert("Mohon lengkapi identitas Anda terlebih dahulu.");

        for (let i = 0; i < SOAL.length; i++) {
            const cek = document.querySelector(`input[name="q${i}"]:checked`);
            if (!cek) {
                el(`soal-${i}`).scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Visual feedback for missed question
                el(`soal-${i}`).style.borderBottom = '2px solid #ef4444';
                setTimeout(() => el(`soal-${i}`).style.borderBottom = '', 2000);
                return alert(`Soal No. ${i+1} belum diisi!`);
            }
            data.jawaban.push(cek.value);
        }

        if(!confirm("Apakah Anda yakin jawaban sudah benar?")) return;

        toggleLoader(true, "Mengirim ke server...");
        
        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(res => {
            toggleLoader(false);
            if (res.status === 'success') {
                alert("Terima kasih! Data berhasil disimpan.");
                location.reload();
            } else {
                alert("Gagal menyimpan: " + res.message);
            }
        })
        .catch(err => {
            toggleLoader(false);
            alert("Terjadi kesalahan koneksi. Silakan coba lagi.");
        });
    }

    function loadReport() {
        toggleLoader(true, "Mengambil Laporan...");
        
        fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(d => {
            toggleLoader(false);
            
            // Render Kelas
            if(d.perKelas && d.perKelas.length) {
                el('report-kelas').innerHTML = `<table><tr><th>Kelas</th><th>Total Siswa</th><th>Rata Skor</th></tr>` +
                d.perKelas.map(x => `<tr><td><b>${x.kelas}</b></td><td>${x.siswa}</td><td><span class="badge">${x.rata}</span></td></tr>`).join('') + `</table>`;
            } else { el('report-kelas').innerHTML = "<p style='text-align:center; padding:20px;'>Belum ada data masuk.</p>"; }

            // Render Siswa
            if(d.perSiswa && d.perSiswa.length) {
                el('report-siswa').innerHTML = `<table><tr><th>Nama Siswa</th><th>Skor</th></tr>` +
                d.perSiswa.map(x => `<tr><td><b>${x.nama}</b><br><small style='color:var(--text-muted)'>${x.kelas} â€¢ ${x.tanggal}</small></td><td valign="top"><span class="badge">${x.skor}</span></td></tr>`).join('') + `</table>`;
            } else { el('report-siswa').innerHTML = "<p style='text-align:center; padding:20px;'>Belum ada data masuk.</p>"; }
        })
        .catch(err => {
            toggleLoader(false);
            el('report-kelas').innerHTML = "Gagal memuat data.";
        });
    }
</script>
</body>
</html>
